{"componentChunkName":"component---node-modules-gatsby-theme-documentation-src-templates-doc-js","path":"/deprecated/discovery","result":{"data":{"doc":{"id":"ad8dbc40-de77-52fb-8356-3530eb4d7106","title":"","description":null,"excerpt":"Flex Auto Container Discovery ⚠️  Note : this is deprecated functionality that is still provided for backwards compatibility. We encourage…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h3\", {\n    \"id\": \"flex-auto-container-discovery\"\n  }, \"Flex Auto Container Discovery\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u26A0\\uFE0F \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note\"), \": this is deprecated functionality that is still provided for backwards compatibility. We encourage you to use the improved, fully-supported \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.newrelic.com/docs/integrations/host-integrations/installation/container-auto-discovery\"\n  }), \"container auto-discovery mechanism for On-Host Integrations\"), \". \")), mdx(\"p\", null, \"Flex has the capability to auto discovery containers in your surrounding environment, and dynamically monitor them regardless of changing IP addresses and ports.\"), mdx(\"p\", null, \"This requires access to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/var/run/docker.sock\"), \", same as the New Relic Infrastructure Agent, so it is convenient to include Flex in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"newrelic/infrastructure\"), \" image or your k8s daemon set.\"), mdx(\"h2\", {\n    \"id\": \"configuration\"\n  }, \"Configuration\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"  -container_discovery\\n        Enable container auto discovery\\n  -container_discovery_dir string\\n        Set directory of auto discovery config files (default \\\"flexContainerDiscovery/\\\")\\n  -docker_api_version string\\n        Force Docker client API version\\n\")), mdx(\"h2\", {\n    \"id\": \"versions\"\n  }, \"Versions\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#V2-Container-Discovery\"\n  }), \"V2 Container Discovery\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#V1-Container-Discovery\"\n  }), \"V1 Container Discovery\"))), mdx(\"h3\", {\n    \"id\": \"v2-container-discovery\"\n  }, \"V2 Container Discovery\"), mdx(\"p\", null, \"V2 simplifies discovery by allowing everything to be defined by your Flex configuration file: you can place config files within your standard \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexConfigs\"), \" folder. The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"container_discovery\"), \" flag still needs to be enabled to true.\"), mdx(\"p\", null, \"These configs are prefixed with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cd-\"), \" (for example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexConfigs/cd-redis.yml\"), \"). Use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${auto:ip}\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${auto:host}\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${auto:port}\"), \" as your substitution flags.\"), mdx(\"p\", null, \"In this example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"container_discovery\"), \" is enabled and a YAML file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cd-redis.yml\"), \" is placed in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexConfigs\"), \" folder:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"name: redis\\napis: \\n  - name: redis\\n    entity: ${auto:ip}\\n    commands: \\n      - dial: ${auto:ip}:${auto:port}\\n        run: \\\"info\\\\r\\\\n\\\"\\n        split_by: \\\":\\\"\\n\")), mdx(\"p\", null, \"This tells Flex to look for containers with the name that contains \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"redis\"), \" by default, as the name is taken from the text after \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cd-\"), \".\"), mdx(\"p\", null, \"To override this behavior or further configure how you would like to target containers, consider the example below (all are optional parameters):\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {}), \"name: redis\\ncontainer_discovery:\\n  mode: contains # default: contains, other options: prefix, suffix, contains, regex\\n  type: container # default: container, other options: image\\n  target: some-other-container-name # default: text after the \\\"cd-\\\" in the config file name\\n  ip_mode: private # default: automatically set, other options: public, private\\napis: \\n  - name: redis\\n    entity: ${auto:ip}\\n    commands: \\n      - dial: ${auto:ip}:${auto:port}\\n        run: \\\"info\\\\r\\\\n\\\"\\n        split_by: \\\":\\\"\\n\")), mdx(\"h3\", {\n    \"id\": \"v1-container-discovery\"\n  }, \"V1 Container Discovery\"), mdx(\"p\", null, \"In a Kubernetes environment, service environment variables can be passed to every container, so your Flex container can access them. You can use environment variable substitution in a normal config file without using the container discovery feature. Environment variables can be passed to config files by using a double dollar sign (for example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$$MY_ENVIRONMENT_VAR\"), \").\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add a label or annotation that contains the keyword - \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"flexDiscovery\"), \".\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"For Kubernetes, add it as an environment variable.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Add a flex discovery configuration to that same label or annotation, for example, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"flexDiscoveryRedis=\\\"t=redis,c=redis,tt=img,tm=contains\"))), mdx(\"p\", null, \"You could have varying configs on one container, like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexDiscoveryRedis1\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexDiscoveryZookeeper\"), \", etc.\"), mdx(\"p\", null, \"Flex Container Discovery Configs are placed within \\\"flexContainerDiscovery/\\\" directory. For an example see \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"flexContainerDiscovery/redis.yml\"), \".\"), mdx(\"p\", null, \"Use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${auto:host}\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${auto:port}\"), \" anywhere in your config: these are dynamically substituted per container discovered, and makes it possible to have multiple containers re-use the same config with different ip/port configurations.\"), mdx(\"p\", null, \"You can also opt to apply the same environment variable(s) to the Flex container itself, which allows you to monitor other containers without modifying your existing environment. If you have configs that overlap between something set on a container, and something set on the Flex container itself, the Flex container will take precedence.\"), mdx(\"p\", null, \"Flex uses the environment variables that are presented to the Docker Engine; if you have modified the discovery environment variable(s) after deployment for whatever reason, the Docker Engine will be unaware of these changes.\"), mdx(\"h4\", {\n    \"id\": \"flex-discovery-configuration-parameters\"\n  }, \"Flex Discovery Configuration Parameters\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"tt=targetType\"), \" - Target type (default is \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"img\"), \")\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"t=target\"), \" - Keyword to target based on the targetType (for example, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"redis\"), \")\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"tm=targetMode\"), \" - Prefix or regex to match the target (default is \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"contains\"), \")\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"c=config\"), \" - Config file used to create the dynamic configs (defaults to the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"target\"), \" value)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"p=port\"), \" - Target port\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ip=ipMode\"), \" - IP mode. Default is \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"private\"), \" - it can be set to \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"public\"))), mdx(\"p\", null, \"If a config is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nil\"), \", use the target (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"t\"), \"), as the YAML file to look up. For example, if target (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"t\"), \") = \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"redis\"), \", look up the config (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"c\"), \") \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"redis.yml\"), \" if the config is not set.\"));\n}\n;\nMDXContent.isMDXComponent = true;","headings":[{"value":"Flex Auto Container Discovery"},{"value":"Configuration"},{"value":"Versions"},{"value":"V2 Container Discovery"},{"value":"V1 Container Discovery"},{"value":"Flex Discovery Configuration Parameters"}]}},"pageContext":{"id":"ad8dbc40-de77-52fb-8356-3530eb4d7106","slug":"/deprecated/discovery","previous":{"id":"83b307f0-3b44-5ac7-8311-bfe320cf0e63","slug":"/apis"},"next":{"id":"4b0ab7e7-6f32-56e6-8bec-883248e5fd0e","slug":"/experimental/dial"}}}}